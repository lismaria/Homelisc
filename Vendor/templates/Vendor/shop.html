{% extends "Vendor/base-vendor.html" %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'Vendor/shop.css' %}">
{% endblock style %}

{% block title %}Shop{% endblock title %}

{% block content %}
<div class="shop-wrapper">
    <div class="shop-info-card">
        <div class="shop-info__title">
            <h1>Details</h1>
            <button class="shop-noedit-btn">
                <h2>Edit</h2>
                <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.9826 4.10534L12.3946 5.51667L10.9826 4.10534ZM11.8906 2.86201L8.07259 6.68001C7.87531 6.87701 7.74077 7.128 7.68592 7.40134L7.33325 9.16667L9.09859 8.81334C9.37192 8.75867 9.62259 8.62467 9.81992 8.42734L13.6379 4.60934C13.7527 4.49461 13.8437 4.3584 13.9058 4.2085C13.9678 4.05859 13.9998 3.89793 13.9998 3.73567C13.9998 3.57342 13.9678 3.41275 13.9058 3.26285C13.8437 3.11294 13.7527 2.97674 13.6379 2.86201C13.5232 2.74728 13.387 2.65627 13.2371 2.59417C13.0872 2.53208 12.9265 2.50012 12.7643 2.50012C12.602 2.50012 12.4413 2.53208 12.2914 2.59417C12.1415 2.65627 12.0053 2.74728 11.8906 2.86201V2.86201Z" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.6666 10.5V12.5C12.6666 12.8537 12.5262 13.1928 12.2761 13.4428C12.0261 13.6929 11.6869 13.8334 11.3333 13.8334H3.99996C3.64634 13.8334 3.3072 13.6929 3.05715 13.4428C2.8071 13.1928 2.66663 12.8537 2.66663 12.5V5.16671C2.66663 4.81309 2.8071 4.47395 3.05715 4.2239C3.3072 3.97385 3.64634 3.83337 3.99996 3.83337H5.99996" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>                                      
            </button>
            <!-- <button> -->
                <svg class="shop-yesedit-btn" width="21" height="20" viewBox="0 0 26 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21.3334 4.16669L4.66675 20.8334M21.3334 20.8334L4.66675 4.16669L21.3334 20.8334Z" stroke=var(--primary) stroke-width="2" stroke-linecap="round"/>
                </svg>                                                        
            <!-- </button> -->
        </div>
        <div class="shop-noedit">
            {% for i in shopInfo %}
            <div class="shop-info__main" data-id="{{i.id}}">
                <img src="{{i.shop_logo.url}}" alt="">
                <div>
                    <h2>{{i.shop_name}}</h2>
                    <h3>
                        {% for i in i.shop_tags %}
                            {{i}}
                        {% endfor %}
                    </h3>
                </div>
            </div>
            <div class="shop-info__descr">
                <h2>Description</h2>
                <p>{{i.shop_descr}}</p>
            </div>
            <div class="shop-info__contact">
                <h2>Contact Details</h2>
                <a href="{{i.shop_location}}">
                <div>                    
                    <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path  fill=var(--primary) fill-rule="evenodd" clip-rule="evenodd" d="M8.5 6H9.456V13.944H8.5V6Z"/>
                        <path  fill=var(--primary) fill-rule="evenodd" clip-rule="evenodd" d="M9.01112 0.0159912C6.54712 0.0159912 4.54712 2.02399 4.54712 4.49999C4.54712 6.97799 6.54712 8.98399 9.01112 8.98399C11.4761 8.98399 13.4751 6.97699 13.4751 4.49999C13.4751 2.02299 11.4771 0.0159912 9.01112 0.0159912ZM9.17012 1.64199C8.37252 1.63933 7.60652 1.95357 7.04056 2.51558C6.4746 3.0776 6.15503 3.84139 6.15212 4.63899C6.15212 5.30099 5.50412 4.98499 5.50412 3.99399C5.50703 3.19639 5.8266 2.4326 6.39256 1.87058C6.95852 1.30857 7.72452 0.994334 8.52212 0.996991C9.51812 0.996991 9.83612 1.64199 9.17012 1.64199Z"/>
                    </svg>   
                    <h3>{{i.shop_city}}, {{i.shop_state}}</h3>                 
                </div>
                </a>
                <div>
                    <svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill=var(--primary) d="M6.08958 1.65283C6.43964 1.54728 6.8153 1.56482 7.15401 1.70252C7.49272 1.84021 7.77405 2.08977 7.95118 2.40963L8.01118 2.52883L8.53998 3.70563C8.7007 4.06282 8.75288 4.45938 8.69001 4.84598C8.62714 5.23258 8.452 5.59218 8.18638 5.88003L8.08078 5.98563L7.24558 6.76403C7.09518 6.90643 7.20798 7.45763 7.75278 8.40003C8.24158 9.24803 8.64078 9.64403 8.83598 9.66563H8.87038L8.91278 9.65763L10.5528 9.15603C10.7732 9.08844 11.0084 9.08576 11.2303 9.14833C11.4522 9.21089 11.6513 9.33605 11.804 9.50883L11.8776 9.60083L12.9624 11.1048C13.1752 11.3995 13.2814 11.7579 13.2634 12.121C13.2453 12.4841 13.1042 12.8303 12.8632 13.1024L12.7656 13.2032L12.3312 13.6144C11.9418 13.9832 11.4548 14.2323 10.9279 14.3323C10.401 14.4323 9.85656 14.3789 9.35918 14.1784C7.81118 13.5544 6.40478 12.1288 5.12718 9.91603C3.84718 7.69763 3.31518 5.76403 3.55278 4.10803C3.62475 3.60735 3.831 3.13552 4.14962 2.74267C4.46825 2.34981 4.88734 2.0506 5.36238 1.87683L5.51678 1.82563L6.08958 1.65283Z"/>
                    </svg>         
                    <h3>{{i.shop_contact}}</h3>           
                </div>
            </div>
            {% endfor %}
        </div>         

        <div class="shop-yesedit">
            <form id="shop-edit-form" class="register-body" enctype="multipart/form-data" method="post">
                {% csrf_token %}
                <label>NAME</label>
                {{shopForm.shop_name}}
                <!-- <input type="text" placeholder="Shop Name" value="{{i.shop_name}}"> -->
                        
                <label>TAGS</label>
                {{shopForm.shop_tags}}
                <!-- <input type="text" placeholder="Tags (eg. Chocolates,Crafts,..)" value="{{i.shop_tags}}"> -->
            
                <label>DESCRIPTION</label>
                {{shopForm.shop_descr}}
                <!-- <textarea placeholder="Shop Description"></textarea> -->

                <label>CONTACT NUMBER</label>
                {{shopForm.shop_contact}}
                <!-- <input type="tel" placeholder="Shop Contact Number" value="{{i.shop_contact}}"> -->
            
                <label>STATE</label>
                {{shopForm.shop_state}}
                {{shopForm.shop_state.errors}}
                <!-- <select id="select-state"></select> -->
                <!-- <input type="text" value="{{shopForm.shop_state.value}}" id="select-state"> -->

                <label>CITY</label>
                {{shopForm.shop_city}}
                {{shopForm.shop_city.errors}}
                <!-- <input type="text" value="{{shopForm.shop_city.value}}" id="select-city"> -->

                <!-- <select id="select-city"></select> -->

                <label>LOCATION</label>
                <div class="addmap-url">
                    {{shopForm.shop_location}}
                    <!-- <input type="text" placeholder="Add Location" value="{{i.shop_location}}"> -->
                    <a href="https://www.google.com/maps" target="_blank" class="open-maps">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9.99999 17.5C8.94744 16.6022 7.97182 15.6179 7.08332 14.5575C5.74999 12.965 4.16666 10.5933 4.16666 8.33333C4.16608 7.17913 4.50791 6.0507 5.1489 5.09085C5.78989 4.131 6.70122 3.38288 7.76755 2.94116C8.83388 2.49944 10.0073 2.38399 11.1393 2.60941C12.2712 2.83482 13.3109 3.39098 14.1267 4.2075C14.6698 4.74821 15.1003 5.39128 15.3932 6.09947C15.6862 6.80767 15.8358 7.56694 15.8333 8.33333C15.8333 10.5933 14.25 12.965 12.9167 14.5575C12.0282 15.6179 11.0525 16.6022 9.99999 17.5ZM9.99999 5.83333C9.33695 5.83333 8.70106 6.09672 8.23222 6.56556C7.76338 7.0344 7.49999 7.67029 7.49999 8.33333C7.49999 8.99637 7.76338 9.63226 8.23222 10.1011C8.70106 10.5699 9.33695 10.8333 9.99999 10.8333C10.663 10.8333 11.2989 10.5699 11.7678 10.1011C12.2366 9.63226 12.5 8.99637 12.5 8.33333C12.5 7.67029 12.2366 7.0344 11.7678 6.56556C11.2989 6.09672 10.663 5.83333 9.99999 5.83333Z" fill="#964B00"/>
                        </svg>
                        <p>Open Maps</p>
                    </a>
                </div>

                <label>LOGO</label>
                <div class="add-logo-frame">
                    {% for i in shopInfo %}
                        <img src="{{i.shop_logo.url}}" id="logo_pic" class="object-fit">
                    {% endfor %}
                    <label class="add-logolabel" for="add_logo">
                        <p>Add Logo</p>
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 8C3 8.55 3.45 9 4 9C4.55 9 5 8.55 5 8V6H7C7.55 6 8 5.55 8 5C8 4.45 7.55 4 7 4H5V2C5 1.45 4.55 1 4 1C3.45 1 3 1.45 3 2V4H1C0.45 4 0 4.45 0 5C0 5.55 0.45 6 1 6H3V8Z" fill="black"/>
                            <path d="M13 17C14.6569 17 16 15.6569 16 14C16 12.3431 14.6569 11 13 11C11.3431 11 10 12.3431 10 14C10 15.6569 11.3431 17 13 17Z" fill="black"/>
                            <path d="M21 6H17.83L16.59 4.65C16.4036 4.44539 16.1767 4.28191 15.9235 4.16999C15.6704 4.05807 15.3968 4.00017 15.12 4H8.72C8.89 4.3 9 4.63 9 5C9 6.1 8.1 7 7 7H6V8C6 9.1 5.1 10 4 10C3.63 10 3.3 9.89 3 9.72V20C3 21.1 3.9 22 5 22H21C22.1 22 23 21.1 23 20V8C23 6.9 22.1 6 21 6ZM13 19C10.24 19 8 16.76 8 14C8 11.24 10.24 9 13 9C15.76 9 18 11.24 18 14C18 16.76 15.76 19 13 19Z" fill="black"/>
                        </svg>
                    </label>
                    {{shopForm.shop_logo}}
                    <!-- <input id="add_logo" type="file" style="display:none;" onchange="document.getElementById('logo_pic').src = window.URL.createObjectURL(this.files[0])" accept="image/*"> -->
                </div>
                {% for i in shopInfo %}
                <input type="hidden" name="shopid" value="{{i.id}}">
                {% endfor %}
                <div class="save-button-div">
                    <!-- <button type="submit">Save Changes</button> -->
                    <button class="add-btn">
                        <svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10.5 1.66675C5.90496 1.66675 2.16663 5.40508 2.16663 10.0001C2.16663 14.5951 5.90496 18.3334 10.5 18.3334C15.095 18.3334 18.8333 14.5951 18.8333 10.0001C18.8333 5.40508 15.095 1.66675 10.5 1.66675ZM10.5 16.6667C6.82413 16.6667 3.83329 13.6759 3.83329 10.0001C3.83329 6.32425 6.82413 3.33341 10.5 3.33341C14.1758 3.33341 17.1666 6.32425 17.1666 10.0001C17.1666 13.6759 14.1758 16.6667 10.5 16.6667Z" fill="white"/>
                            <path d="M7.58337 10C8.27373 10 8.83337 9.44036 8.83337 8.75C8.83337 8.05964 8.27373 7.5 7.58337 7.5C6.89302 7.5 6.33337 8.05964 6.33337 8.75C6.33337 9.44036 6.89302 10 7.58337 10Z" fill="white"/>
                            <path d="M13.4108 9.98833C14.0979 9.98833 14.655 9.4313 14.655 8.74417C14.655 8.05703 14.0979 7.5 13.4108 7.5C12.7237 7.5 12.1666 8.05703 12.1666 8.74417C12.1666 9.4313 12.7237 9.98833 13.4108 9.98833Z" fill="white"/>
                            <path d="M10.5 15.0001C13.8334 15.0001 14.6667 11.6667 14.6667 11.6667H6.33337C6.33337 11.6667 7.16671 15.0001 10.5 15.0001Z" fill="white"/>
                        </svg>
                        <p>Save Changes</p>
                    </button>
                </div>
            </form>
        </div> 
    </div>
</div>

<div class="vendor-nav">{% include "Vendor/vendor-lowernav.html" %}</div>
{% endblock content %}

{% block javascript %}
<script>
    $(document).ready(function () {
        $('#select-state').append('<option class="disabled-select" value="" disabled selected>State</option>')
        $('#select-city').append('<option class="disabled-select" value="" disabled selected>City</option>')        

        $("#page-heading").remove()
        $( ".vendor-page-header" ).append("<a class='vendor-page-a' href={% url 'vendor:home' %}><a>");
        $('.vendor-page-a').append("<h1>< Return to Home</h1>")

        $(".shop-noedit-btn").click(function () {
            $(".shop-noedit, .shop-noedit-btn").hide();
            $(".shop-yesedit, .shop-yesedit-btn").show();
        })
        $(".shop-yesedit-btn").click(function () {
            $(".shop-yesedit, .shop-yesedit-btn").hide();
            $(".shop-noedit, .shop-noedit-btn").show();
        })

        $('input[type="file"]').change(function() {
            $('.add-logolabel>p, .add-logolabel>svg').css({'z-index':-1})
        });

        if($('.add-logo-frame img').attr('src')!="")
            $('.add-logolabel>p, .add-logolabel>svg').css({'z-index':-1})


        const API_KEY='dTdYMkMxdjYyaFZzQllqMHp6ZWxud3piSk53bTBiWmdIZU95R1VVWA=='
        $.ajax({
            type: 'get',
            url: 'https://api.countrystatecity.in/v1/countries/IN/states',
            success: function(data){
                data.forEach(element => {
                    $('#select-state').append('<option class="select-state-option" data-iso2="'+element.iso2+'">'+element.name+'</option>')
                });
            },
            error: function(error){
                console.log("error",error);
            },
            headers: {
                'X-CSCAPI-KEY': API_KEY
            }
        })
        
        
        function getCity(state) {
            console.log("state: " + state)
            $.ajax({
            type: 'get',
            url: 'https://api.countrystatecity.in/v1/countries/IN/states/'+state+'/cities',
            success: function(data){
                console.log("ajax",data);
                data.forEach(element => {
                    $('#select-city').append('<option>'+element.name+'</option>')
                });
            },
            error: function(error){
                console.log("error",error);
            },
            headers: {
                'X-CSCAPI-KEY': API_KEY
            }
        }) 
        }

        $('#select-state').change(function(){
            $('#select-city').empty();
            getCity($(this).find(':selected').data('iso2'))
        })



        // console.log(csrftoken);
        var id = $(".shop-info__main").data('id');
        $("#shop-edit-form").submit(function (e) {
            console.log("submit")
            // preventing from page reload and default actions
            e.preventDefault();
            // serialize the data for sending the form data.
            var serializedData = new FormData($('#shop-edit-form')[0]);
            // make POST ajax call
            $.ajax({
                type: 'POST',
                // beforeSend: function (request)
                // {
                //     request.setRequestHeader("X-CSRFToken", "${_csrf.token}");
                // },
                url: `{% url 'vendor:shop-update' %}`,
                data: serializedData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    // var res = JSON.parse(response.instance)[0].fields.profile_pic
                    // $("#vendor_profile").attr('src','/media/'+res);
                    alert("Updation Success!");
                    location.reload();
                },
                error:  function (response) {
                    console.log(response);
                    alert("Failed to update");
                }
            })
        })
    })
</script>
{% endblock javascript %}