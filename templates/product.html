{% extends "base.html" %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'product.css' %}">
    <link rel="stylesheet" href="{% static 'review-popup.css' %}">
{% endblock style %}
    
{% block title %}
    {% for i in itemInfo %}
        {{i.item_name}}
    {% endfor %}
{% endblock title %}

{% block content %}
    <div class="product-wrapper">
        {% for i in itemInfo %}
        <div class="product-img">
            <div class="product-heart" data-item_heartid={{i.id}} data-shop_heartid="{{i.shop_id.id}}">
                <svg width="26" height="26" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.6301 3.4575C15.247 3.07425 14.7922 2.77023 14.2916 2.56281C13.791 2.35539 13.2545 2.24863 12.7126 2.24863C12.1707 2.24863 11.6342 2.35539 11.1336 2.56281C10.633 2.77023 10.1782 3.07425 9.79509 3.4575L9.00009 4.2525L8.20509 3.4575C7.43132 2.68373 6.38186 2.24903 5.28759 2.24903C4.19331 2.24903 3.14386 2.68373 2.37009 3.4575C1.59632 4.23127 1.16162 5.28072 1.16162 6.375C1.16162 7.46927 1.59632 8.51873 2.37009 9.2925L3.16509 10.0875L9.00009 15.9225L14.8351 10.0875L15.6301 9.2925C16.0133 8.90943 16.3174 8.45461 16.5248 7.95401C16.7322 7.45342 16.839 6.91686 16.839 6.375C16.839 5.83313 16.7322 5.29657 16.5248 4.79598C16.3174 4.29539 16.0133 3.84056 15.6301 3.4575Z" stroke="#F54748" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>                                                               
            </div>
            <img src="" alt="">
            <div class="product-price">
                <h2>â‚¹ {{i.item_price}}</h2>
            </div>
        </div>
        <div class="product-name">
            <h1>{{i.item_name}}</h1>
            <div>
                <p>{{i.item_rating}}</p>
                <svg width="17" height="16" viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.5798 4.22554L8.68268 3.67806L6.94055 0.264101C6.89297 0.170629 6.81469 0.0949614 6.71799 0.0489671C6.47547 -0.0667604 6.18077 0.0296792 6.05951 0.264101L4.31738 3.67806L0.420236 4.22554C0.312792 4.24038 0.214557 4.28934 0.139346 4.36352C0.0484205 4.45386 -0.00168366 4.57539 4.32016e-05 4.70142C0.00177006 4.82745 0.0551867 4.94766 0.148556 5.03563L2.96819 7.69291L2.30204 11.4452C2.28642 11.5324 2.29641 11.6222 2.33088 11.7043C2.36536 11.7864 2.42293 11.8575 2.49708 11.9095C2.57123 11.9616 2.65898 11.9925 2.75039 11.9988C2.8418 12.0051 2.9332 11.9865 3.01424 11.9452L6.50003 10.1736L9.98582 11.9452C10.081 11.9941 10.1915 12.0104 10.2974 11.9926C10.5645 11.9481 10.7441 11.7033 10.698 11.4452L10.0319 7.69291L12.8515 5.03563C12.9283 4.96293 12.9789 4.86798 12.9943 4.76412C13.0357 4.50447 12.8484 4.26412 12.5798 4.22554V4.22554Z" fill="#01810E"/>
                </svg>
            </div>
        </div>
        <p>{{i.item_descr}}</p>
        {% for j in shopInfo %}
            <a href="{% url 'shop' id=j.id slug=j.shop_slug %}" class="product-shop">
                <div>
                    <img src="{{j.shop_logo.url}}" alt="">
                    <h2>{{j.shop_name}}</h2>
                </div>
                <svg width="17" height="19" viewBox="0 0 17 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.55632 2.40807C4.34721 2.61725 4.22974 2.90091 4.22974 3.19669C4.22974 3.49246 4.34721 3.77613 4.55632 3.98531L10.0778 9.50675L4.55632 15.0282C4.35314 15.2386 4.24071 15.5203 4.24325 15.8128C4.24579 16.1053 4.3631 16.385 4.56991 16.5918C4.77672 16.7987 5.05649 16.916 5.34896 16.9185C5.64142 16.921 5.92318 16.8086 6.13356 16.6054L12.4436 10.2954C12.6527 10.0862 12.7702 9.80253 12.7702 9.50675C12.7702 9.21097 12.6527 8.92731 12.4436 8.71813L6.13356 2.40807C5.92438 2.19896 5.64072 2.08148 5.34494 2.08148C5.04917 2.08148 4.7655 2.19896 4.55632 2.40807Z" fill="black"/>
                </svg>
            </a>
        {% endfor %}
        <div class="product-review">
            <h3>Leave a Review</h3>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.474 5.40801L18.592 7.52501L16.474 5.40801ZM17.836 3.54301L12.109 9.27001C11.8131 9.56551 11.6113 9.94199 11.529 10.352L11 13L13.648 12.47C14.058 12.388 14.434 12.187 14.73 11.891L20.457 6.16401C20.6291 5.99191 20.7656 5.7876 20.8588 5.56275C20.9519 5.33789 20.9998 5.09689 20.9998 4.85351C20.9998 4.61013 20.9519 4.36913 20.8588 4.14427C20.7656 3.91942 20.6291 3.71511 20.457 3.54301C20.2849 3.37091 20.0806 3.2344 19.8557 3.14126C19.6309 3.04812 19.3899 3.00018 19.1465 3.00018C18.9031 3.00018 18.6621 3.04812 18.4373 3.14126C18.2124 3.2344 18.0081 3.37091 17.836 3.54301V3.54301Z" stroke=var(--primary) stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M19 15V18C19 18.5304 18.7893 19.0391 18.4142 19.4142C18.0391 19.7893 17.5304 20 17 20H6C5.46957 20 4.96086 19.7893 4.58579 19.4142C4.21071 19.0391 4 18.5304 4 18V7C4 6.46957 4.21071 5.96086 4.58579 5.58579C4.96086 5.21071 5.46957 5 6 5H9" stroke=var(--primary) stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>                
        </div>
        <div class="review-wrapper">
            {% for k in itemReviews %}
            <div class="review-container item-review-container">
                <div class="review-card">
                    <img src="{{k.user_id.profile_pic.url}}" alt="">
                    <div>
                        <div class="review-card-heading">
                            <div>
                                <h4>{{k.user_id.name}}</h4>
                                <div class="review-rating">
                                    <p>{{k.stars}}</p>
                                    <svg width="8" height="7" viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12.5798 4.22554L8.68268 3.67806L6.94055 0.264101C6.89297 0.170629 6.81469 0.0949614 6.71799 0.0489671C6.47547 -0.0667604 6.18077 0.0296792 6.05951 0.264101L4.31738 3.67806L0.420236 4.22554C0.312792 4.24038 0.214557 4.28934 0.139346 4.36352C0.0484205 4.45386 -0.00168366 4.57539 4.32016e-05 4.70142C0.00177006 4.82745 0.0551867 4.94766 0.148556 5.03563L2.96819 7.69291L2.30204 11.4452C2.28642 11.5324 2.29641 11.6222 2.33088 11.7043C2.36536 11.7864 2.42293 11.8575 2.49708 11.9095C2.57123 11.9616 2.65898 11.9925 2.75039 11.9988C2.8418 12.0051 2.9332 11.9865 3.01424 11.9452L6.50003 10.1736L9.98582 11.9452C10.081 11.9941 10.1915 12.0104 10.2974 11.9926C10.5645 11.9481 10.7441 11.7033 10.698 11.4452L10.0319 7.69291L12.8515 5.03563C12.9283 4.96293 12.9789 4.86798 12.9943 4.76412C13.0357 4.50447 12.8484 4.26412 12.5798 4.22554V4.22554Z" fill="#FFFFFF"/>
                                    </svg>
                                </div>
                            </div>
                            <h2>{{k.date|date:"M d, Y"}}</h2>
                        </div>
                        <p>{{k.comment}}</p>
                        <div class="review-itemimg">
                            {% if k.review_img %}
                                <img src="{{k.review_img.url}}" alt="" srcset="">
                            {% endif %}
                            </div>
                        <div class="review-likes">
                            <div>
                                <svg class="like-btn" data-likeid={{k.id}} width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_145_880)">
                                    <path d="M14.3044 6.25613C14.3044 5.56579 13.7447 5.01228 13.0605 5.01228H9.12999L9.72704 2.17009C9.73948 2.1079 9.74569 2.03948 9.74569 1.97107C9.74569 1.71608 9.63997 1.47975 9.47205 1.31183L8.81281 0.658813L4.72055 4.75107C4.49044 4.98118 4.35361 5.29215 4.35361 5.63421V11.8534C4.35361 12.1833 4.48466 12.4997 4.71793 12.733C4.9512 12.9662 5.26757 13.0973 5.59746 13.0973H11.1948C11.711 13.0973 12.1525 12.7863 12.3391 12.3385L14.2173 7.95398C14.2733 7.81094 14.3044 7.66168 14.3044 7.49998V6.25613ZM0.62207 13.0973H3.10977V5.63421H0.62207V13.0973Z" fill="black"/>
                                    </g>
                                    <defs>
                                    <clipPath id="clip0_145_880">
                                    <rect width="14.9262" height="14.9262" fill="white" transform="translate(0 0.0369263)"/>
                                    </clipPath>
                                    </defs>
                                </svg>
                                <p>{{k.likes_count}}</p>
                            </div>

                            <div>
                            {% if k.heart_by_owner == True %}
                                <img src="{{k.shop_id.shop_logo.url}}" alt="">
                                <svg width="14" height="14" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M15.6301 3.4575C15.247 3.07425 14.7922 2.77023 14.2916 2.56281C13.791 2.35539 13.2545 2.24863 12.7126 2.24863C12.1707 2.24863 11.6342 2.35539 11.1336 2.56281C10.633 2.77023 10.1782 3.07425 9.79509 3.4575L9.00009 4.2525L8.20509 3.4575C7.43132 2.68373 6.38186 2.24903 5.28759 2.24903C4.19331 2.24903 3.14386 2.68373 2.37009 3.4575C1.59632 4.23127 1.16162 5.28072 1.16162 6.375C1.16162 7.46927 1.59632 8.51873 2.37009 9.2925L3.16509 10.0875L9.00009 15.9225L14.8351 10.0875L15.6301 9.2925C16.0133 8.90943 16.3174 8.45461 16.5248 7.95401C16.7322 7.45342 16.839 6.91686 16.839 6.375C16.839 5.83313 16.7322 5.29657 16.5248 4.79598C16.3174 4.29539 16.0133 3.84056 15.6301 3.4575Z" fill="#F54748" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% for reply in vendorReplies %}
                    {% if reply.review_id.id == k.id %}
                        <div class="review-comment vendor-reply">
                            <div class="reply-card reply-card-item">
                                <div class="reply-card-heading">
                                    <h4>{{reply.shop_id.shop_name}}</h4>
                                    <p>{{reply.date|date:"M d, Y"}}</p>
                                </div>
                                <p class="reply-card-reply">{{reply.reply}}</p>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            {% endfor %}
        </div>

        <!--Creates the popup -->
        {% if request.user.is_authenticated %}
            {% include 'review-popup.html' %}
        {% else %}
            {% include 'login-required.html' %}
        {% endif %}

        {% endfor %}
    </div>

{% endblock content %}

{% block javascript %}
<script>
    $(document).ready(function () {
        var not_login = $(".login-required-wrapper").length

        // Wishlist a Shop - ajax call
        $(".product-heart").click(function () {
            if(not_login)
            {
                $(".login-required-wrapper").addClass("active");
                    setTimeout(function() {
                $(".login-required-wrapper").removeClass("active");
                }, 5000);
            }
            else{
                var shop_heartid = $(this).data('shop_heartid');
                var item_heartid = $(this).data('item_heartid');
                var that = $(this).children("svg");
                $.ajax({
                    type: 'post',
                    url: "{% url 'add-wishlist' %}",
                    data: {
                        shop_heartid : shop_heartid,
                        item_heartid : item_heartid
                    },
                    success: function (response){
                        that.toggleClass("heart");
                        alert(response.msg);
                        // location.reload();
                    },
                    error:  function (response){
                        alert(response.responseJSON.error);
                    }
                });
            }
        });

        $(".like-btn").click(function () {
            if(not_login)
            {
                $(".login-required-wrapper").addClass("active");
                    setTimeout(function() {
                $(".login-required-wrapper").removeClass("active");
                }, 5000);
            }

            else
            {
                var reviewid = $(this).data('likeid');
                var that = $(this);
                
                $.ajax({
                    type: "POST",
                    url: "{% url 'review-like' %}",
                    data: {
                        reviewid : reviewid
                    },
                    success: function (response) {
                        that.next().text(response.likes);
                    },
                    error:  function (response) {
                        console.log(response);
                    }
                })
            }
        })
    });
</script>
{% endblock javascript%}